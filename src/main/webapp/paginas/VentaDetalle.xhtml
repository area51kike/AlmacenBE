<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="jakarta.faces.core">

<h:head>
    <meta charset="UTF-8"/>
    <h:outputStylesheet library="estilos" name="disenoAlmacen.css"/>
    <title>#{msg['ventaDetalle.titulo.principal']}</title>
</h:head>

<h:body>
    <div class="page-container">
        <ui:include src="/paginas/ues/Sidebar.xhtml"/>
        <div class="container">
            <div class="header">
                <h1>#{msg['ventaDetalle.titulo.principal']}</h1>
            </div>

            <div class="content">

                <p:growl id="messages" showDetail="true" life="5000" sticky="false"/>

                <h:panelGroup id="pnlTabla" layout="block"
                              style="display:#{ventaDetalleFrm.estado eq 'NADA' ? 'block' : 'none'}; width: 100%;">
                    <div class="content-tabla">
                        <h:form id="frmTabla">
                            <p:dataTable id="tblVentaDetalle"
                                         lazy="true"
                                         rendered="#{ventaDetalleFrm.estado == 'NADA'}"
                                         rows="#{ventaDetalleFrm.pageSize}"
                                         paginator="true"
                                         paginatorPosition="bottom"
                                         value="#{ventaDetalleFrm.modelo}"
                                         var="item"
                                         selectionMode="single"
                                         selection="#{ventaDetalleFrm.registro}"
                                         rowKey="#{item.id}">

                                <p:ajax event="rowSelect" listener="#{ventaDetalleFrm.selectionHandler}"
                                        update=":pnlTabla :pnlDetalle, :messages"/>
                                <p:ajax event="rowUnselect" listener="#{ventaDetalleFrm.btnCancelarHandler}"
                                        update=":pnlTabla :pnlDetalle, :messages"/>

                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.id']}" width="150" sortBy="#{item.id}"><h:outputText value="#{item.id}"/></p:column>
                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.venta']}" sortBy="#{item.idVenta.id}"><h:outputText value="#{item.idVenta.id}"/></p:column>
                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.producto']}" sortBy="#{item.idProducto.nombreProducto}"><h:outputText value="#{item.idProducto.nombreProducto}"/></p:column>
                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.cantidad']}" sortBy="#{item.cantidad}"><h:outputText value="#{item.cantidad}"/></p:column>
                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.precio']}" sortBy="#{item.precio}"><h:outputText value="#{item.precio}"><f:convertNumber type="currency" currencySymbol="$"/></h:outputText></p:column>
                                <p:column headerText="#{msg['tabla.ventaDetalle.columna.estado']}" sortBy="#{item.estado}"><h:outputText value="#{item.estado}"/></p:column>
                            </p:dataTable>

                            <ui:include src="/paginas/ues/BotonesTop.xhtml">
                                <ui:param name="section" value="nuevo"/>
                                <ui:param name="bean" value="#{ventaDetalleFrm}"/>
                            </ui:include>
                        </h:form>
                    </div>
                </h:panelGroup>

                <h:panelGroup id="pnlDetalle" layout="block"
                              style="display:#{ventaDetalleFrm.estado ne 'NADA' ? 'block' : 'none'}; width: 100%;">
                    <h:form id="frmCrear" rendered="#{ventaDetalleFrm.estado != 'NADA'}">

                        <h:panelGrid columns="2" cellpadding="5" style="margin-top: 10px; width: 60%;">

                            <h:outputLabel for="txtIdPanel" value="#{msg['ventaDetalle.campo.id']}"/>
                            <h:panelGroup id="txtIdPanel">
                                <h:outputText rendered="#{empty ventaDetalleFrm.registro.id}" value="(#{msg['ventaDetalle.id.autogenerado']})"/>
                                <h:inputText id="txtId" value="#{ventaDetalleFrm.registro.id}" rendered="#{not empty ventaDetalleFrm.registro.id}" disabled="true"/>
                            </h:panelGroup>

                            <h:outputLabel for="selVenta" value="#{msg['ventaDetalle.campo.venta']}"/>
                            <p:selectOneMenu id="selVenta"
                                             value="#{ventaDetalleFrm.registro.idVenta.id}"
                                             required="true"
                                             requiredMessage="#{msg['mensaje.validacion.venta.requerida']}"
                                             filter="true"
                                             filterMatchMode="contains"
                                             style="width: 280px;">
                                <f:selectItem itemLabel="Seleccione Venta" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{ventaDetalleFrm.ventasDisponibles}" var="venta"
                                               itemLabel="ID: #{venta.id} | Estado: #{venta.estado} | Obs: #{venta.observaciones}" itemValue="#{venta.id}" />
                            </p:selectOneMenu>

                            <h:outputLabel for="selProducto" value="#{msg['ventaDetalle.campo.producto']}"/>
                            <p:selectOneMenu id="selProducto"
                                             value="#{ventaDetalleFrm.registro.idProducto.id}"
                                             required="true"
                                             requiredMessage="#{msg['mensaje.validacion.producto.requerido']}"
                                             filter="true"
                                             filterMatchMode="contains"
                                             style="width: 280px;">
                                <f:selectItem itemLabel="Seleccione Producto" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{ventaDetalleFrm.productosDisponibles}" var="prod"
                                               itemLabel="#{prod.nombreProducto} (Ref: #{prod.referenciaExterna})" itemValue="#{prod.id}" />
                            </p:selectOneMenu>

                            <h:outputLabel for="txtCantidad" value="#{msg['ventaDetalle.campo.cantidad']}"/>
                            <p:inputNumber id="txtCantidad"
                                           value="#{ventaDetalleFrm.registro.cantidad}"
                                           required="true"
                                           requiredMessage="#{msg['mensaje.validacion.cantidad.requerida']}"
                                           minValue="0.1" decimalPlaces="1"/>

                            <h:outputLabel for="txtPrecio" value="#{msg['ventaDetalle.campo.precio']}"/>
                            <p:inputNumber id="txtPrecio"
                                           value="#{ventaDetalleFrm.registro.precio}"
                                           required="true"
                                           requiredMessage="#{msg['mensaje.validacion.precio.requerida']}"
                                           symbol="$" symbolPosition="p"
                                           minValue="0.00" decimalPlaces="2"/>

                            <h:outputLabel for="selEstado" value="#{msg['ventaDetalle.campo.estado']}"/>
                            <p:selectOneMenu id="selEstado"
                                             value="#{ventaDetalleFrm.registro.estado}"
                                             required="true"
                                             requiredMessage="#{msg['mensaje.validacion.estado.requerida']}"
                                             style="width: 150px;">
                                <f:selectItem itemLabel="Seleccione Estado" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{ventaDetalleFrm.estadosDisponibles}" var="e"
                                               itemLabel="#{e}" itemValue="#{e}" />
                            </p:selectOneMenu>

                            <h:outputLabel for="txtObs" value="#{msg['ventaDetalle.campo.observaciones']}"/>
                            <p:inputTextarea id="txtObs"
                                             value="#{ventaDetalleFrm.registro.observaciones}"
                                             rows="3" cols="40"
                                             style="width: 100%;"/>

                        </h:panelGrid>

                        <h:panelGroup layout="block" style="margin-top: 15px;">
                            <ui:include src="/paginas/ues/BotonesTop.xhtml">
                                <ui:param name="section" value="crud"/>
                                <ui:param name="bean" value="#{ventaDetalleFrm}"/>
                            </ui:include>

                            <ui:include src="/paginas/ues/BotonesTop.xhtml">
                                <ui:param name="section" value="cancelar"/>
                                <ui:param name="bean" value="#{ventaDetalleFrm}"/>
                            </ui:include>
                        </h:panelGroup>
                    </h:form>
                </h:panelGroup>
            </div>
        </div>
    </div>
</h:body>
</html>